# Настройка базы данных

## Обзор

Проект поддерживает две базы данных:
- **SQLite** - для разработки (ограниченная функциональность)
- **PostgreSQL** - для продакшн (полная функциональность)

## SQLite (для разработки)

SQLite используется по умолчанию и не требует дополнительной настройки. Однако он не поддерживает:
- UUID в качестве первичных ключей
- JSONB типы
- Массивы (TEXT[])
- Полнотекстовый поиск
- Расширения PostgreSQL

### Использование SQLite

Просто запустите приложение - база данных создастся автоматически:

```bash
cd backend
venv\Scripts\activate
python run.py
```

База данных будет создана в файле `requirements.db` в папке `backend`.

## PostgreSQL (рекомендуется)

PostgreSQL обеспечивает полную функциональность системы, включая:
- RBAC (роли и права доступа)
- Системные компоненты
- Трассировка требований
- История изменений
- И многое другое

### Установка PostgreSQL

1. Скачайте PostgreSQL с [postgresql.org](https://www.postgresql.org/download/)
2. Установите PostgreSQL
3. Запомните пароль пользователя `postgres`

### Инициализация базы данных

1. Создайте базу данных:
   ```bash
   psql -U postgres
   CREATE DATABASE requirements_db;
   \q
   ```

2. Примените скрипт инициализации:
   ```bash
   psql -U postgres -d requirements_db -f database/init_database.sql
   ```

Подробные инструкции см. в [database/INIT_INSTRUCTIONS.md](../database/INIT_INSTRUCTIONS.md)

### Настройка подключения

Создайте файл `.env` в корне проекта:

```env
DATABASE_URL=postgresql://postgres:your_password@localhost/requirements_db
```

Замените `your_password` на ваш пароль PostgreSQL.

### Проверка подключения

Запустите backend:

```bash
cd backend
venv\Scripts\activate
python run.py
```

Если подключение успешно, приложение запустится без ошибок.

## Миграция с SQLite на PostgreSQL

Если вы использовали SQLite и хотите перейти на PostgreSQL:

1. Экспортируйте данные из SQLite (если есть):
   ```bash
   sqlite3 requirements.db .dump > backup.sql
   ```

2. Инициализируйте PostgreSQL (см. выше)

3. Импортируйте данные (требует адаптации SQL скрипта)

⚠️ **Внимание:** Прямой импорт из SQLite в PostgreSQL требует преобразования типов данных.

## Структура базы данных

Полная схема базы данных включает:

- **RBAC**: Пользователи, роли, права доступа
- **Проекты**: Контекст для всех артефактов
- **Требования**: По стандарту ISO/IEC/IEEE 29148
- **Системные компоненты**: Микросервисы, библиотеки, БД и т.д.
- **UI элементы**: Экраны, формы, поля
- **Трассировка**: Связи между требованиями, компонентами и UI
- **История изменений**: Полный аудит
- **Комментарии**: Обсуждения артефактов
- **Тест-кейсы**: Верификация требований
- **Документация**: Спецификации и диаграммы
- **Риски**: Трекинг рисков проекта
- **Метрики**: KPI и метрики выполнения
- **Сущности**: Акторы, объекты данных, бизнес-процессы

Подробнее см. [database/README.md](../database/README.md)

## Версия схемы

Текущая версия схемы: **1.4.1**

Скрипт инициализации: `database/init_database.sql`
